(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{849:function(s,a,t){"use strict";t.r(a);var n=t(77),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"vue-项目优化实践-gzip-篇"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vue-项目优化实践-gzip-篇"}},[s._v("#")]),s._v(" Vue 项目优化实践-Gzip 篇")]),s._v(" "),t("h2",{attrs:{id:"前端页面文件缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前端页面文件缓存"}},[s._v("#")]),s._v(" 前端页面文件缓存")]),s._v(" "),t("p",[s._v("我们先来简单回顾下 http 缓存的知识：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("HTTP1.0")]),s._v(" 是通过"),t("code",[s._v("Expires")]),s._v("（文件过期时间）和"),t("code",[s._v("Last-Modified")]),s._v("（最近修改时间）来告诉浏览器进行缓存的，这两个字段都是  UTC  时间（绝对时间）。"),t("code",[s._v("Expires")]),s._v(" 过期控制不稳定，因为浏览器端可以随意修改本地时间，导致缓存使用不精准。而且 "),t("code",[s._v("Last-Modified")]),s._v(" 过期时间只能精确到秒。")]),s._v(" "),t("li",[t("code",[s._v("HTTP1.1")]),s._v("  通过"),t("code",[s._v("Cache-Contorl")]),s._v("和  "),t("code",[s._v("Etag")]),s._v("（版本号）进行缓存控制。浏览器先检查  "),t("code",[s._v("Cache-Control")]),s._v("，如果有，则以"),t("code",[s._v("Cache-Control")]),s._v(" 为准，忽略"),t("code",[s._v("Expires")]),s._v("。如果没有  "),t("code",[s._v("Cache-Control")]),s._v("，则以"),t("code",[s._v("Expires")]),s._v(" 为准。")])]),s._v(" "),t("p",[t("code",[s._v("Cache-Control")]),s._v(" 除了可以设置 "),t("code",[s._v("max-age")]),s._v("（相对过期时间，以秒为单位）以外，还可以设置如下几种常用值:")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("public")]),s._v("，资源允许被中间服务器缓存。浏览器请求服务器时，如果缓存时间没到，中间服务器直接返回给浏览器内容，而不必请求源服务器。")]),s._v(" "),t("li",[t("code",[s._v("private")]),s._v("，资源不允许被中间代理服务器缓存。浏览器请求服务器时，中间服务器都要把浏览器的请求透传给服务器。")]),s._v(" "),t("li",[t("code",[s._v("no-cache")]),s._v("，不管本地副本是否过期，每次访问资源，浏览器都要向服务器询问，如果文件没变化，服务器只告诉浏览器继续使用缓存（304）。")]),s._v(" "),t("li",[t("code",[s._v("no-store")]),s._v("，浏览器和中间代理服务器都不能缓存资源。每次访问资源，浏览器都必须请求服务器，并且，服务器不去检查文件是否变化，而是直接返回完整的资源。")]),s._v(" "),t("li",[t("code",[s._v("must-revalidate")]),s._v("，本地副本过期前，可以使用本地副本；本地副本一旦过期，必须去源服务器进行有效性校验。")]),s._v(" "),t("li",[t("code",[s._v("proxy-revalidate")]),s._v("，要求代理服务器针对缓存资源向源服务器进行确认。")]),s._v(" "),t("li",[t("code",[s._v("s-maxage")]),s._v("：缓存服务器对资源缓存的最大时间。")])]),s._v(" "),t("p",[s._v("现在 99%的浏览器都是 HTTP1.1 及以上版本，我们配置缓存就使用 "),t("code",[s._v("Cache-Contorl")]),s._v(" 和 "),t("code",[s._v("Etag")]),s._v(" 配合就好了。")]),s._v(" "),t("h2",{attrs:{id:"服务器配置缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务器配置缓存"}},[s._v("#")]),s._v(" 服务器配置缓存")]),s._v(" "),t("p",[s._v("文件名带 hash 的(即 css、js、font 和 img 目录下的所有文件)设置一个月缓存，浏览器可以直接使用缓存不需要请求服务器。其他的文件（index.html 和 static 目录下的文件）设置为 "),t("code",[s._v("no-cache")]),s._v("，即每次都来服务器检查是否最新。nginx 配置如下：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    location = /index.html "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        add_header Cache-Control no-cache;\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    location ~ /static/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        add_header Cache-Control no-cache;\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    location ~ /(js/_|css/_|img/_|font/_) "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        expires "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("d;\n        add_header Cache-Control public;\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h2",{attrs:{id:"前端文件设置-gzip-压缩"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前端文件设置-gzip-压缩"}},[s._v("#")]),s._v(" 前端文件设置 gzip 压缩")]),s._v(" "),t("p",[s._v("首先需要安装一个 "),t("code",[s._v("webpack")]),s._v(" 插件，作用是将大文件压缩成 "),t("code",[s._v("gzip")]),s._v(" 的格式。执行一下命令进行安装：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("npm install "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("save"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dev compression"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("webpack"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plugin\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("安装成功后，在 "),t("code",[s._v("vue.config.js")]),s._v(" 进行配置，配置如下：")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" CompressionWebpackPlugin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"compression-webpack-plugin"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 可加入需要的其他文件类型，比如json")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 图片不要压缩，体积会比原来还大")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" productionGzipExtensions "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"css"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("configureWebpack")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("config")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE_ENV")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"production"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        plugins"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CompressionWebpackPlugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// filename: '[path].gz[query]',")]),s._v("\n            algorithm"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gzip"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            test"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RegExp")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\\\.("')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" productionGzipExtensions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"|"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('")$"')]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            threshold"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10240")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//对超过10k的数据进行压缩")]),s._v("\n            minRatio"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 压缩比例，值为0 ~ 1")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[s._v("这样配置后，打包完的 js 和 css 文件就多了后缀名为 "),t("code",[s._v("gz")]),s._v(" 的文件，下面是是否开启 "),t("code",[s._v("gzip")]),s._v(" 压缩的文件大小对比：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("File")]),s._v(" "),t("th",[s._v("Size")]),s._v(" "),t("th",[s._v("Gzipped")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("dist\\static\\lib\\echarts.4.0.6.min.js")]),s._v(" "),t("td",[s._v("729.99KB")]),s._v(" "),t("td",[s._v("243.57KB")])]),s._v(" "),t("tr",[t("td",[s._v("dis\\static\\lib\\jquery.3.3.1.min.js")]),s._v(" "),t("td",[s._v("84.89KB")]),s._v(" "),t("td",[s._v("29.65KB")])]),s._v(" "),t("tr",[t("td",[s._v("dist\\js\\chuck-vendors.41428558.js")]),s._v(" "),t("td",[s._v("2316.10KB")]),s._v(" "),t("td",[s._v("623.74KB")])]),s._v(" "),t("tr",[t("td",[s._v("dist\\js\\app.aea87398.js")]),s._v(" "),t("td",[s._v("1701.24KB")]),s._v(" "),t("td",[s._v("447.00KB")])]),s._v(" "),t("tr",[t("td",[s._v("dist\\css\\app.c6e9f88a.css")]),s._v(" "),t("td",[s._v("464.43KB")]),s._v(" "),t("td",[s._v("137.84KB")])]),s._v(" "),t("tr",[t("td",[s._v("dist\\css\\chunk-vendors.aa340280.css")]),s._v(" "),t("td",[s._v("263.42KB")]),s._v(" "),t("td",[s._v("38.56KB")])])])]),s._v(" "),t("h2",{attrs:{id:"服务器配置-gzip-压缩"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务器配置-gzip-压缩"}},[s._v("#")]),s._v(" 服务器配置 gzip 压缩")]),s._v(" "),t("p",[s._v("Nginx 服务器的配置文件 "),t("code",[s._v("nginx.conf")]),s._v(" 的 "),t("code",[s._v("http")]),s._v(" 模块：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('server {\n  # 开启gzip on为开启，off为关闭\n  gzip on;\n  # 检查是否存在请求静态文件的gz结尾的文件，如果有则直接返回该gz文件内容，不存在则先压缩再返回\n  gzip_static on;\n  # 设置允许压缩的页面最小字节数，页面字节数从header头中的Content-Length中进行获取。\n  # 默认值是0，不管页面多大都压缩。\n  # 建议设置成大于10k的字节数，配合compression-webpack-plugin\n  gzip_min_length 10k;\n  # 对特定的MIME类型生效,其中\'text/html’被系统强制启用\n  gzip_types text/javascript application/javascript text/css application/json;\n  # Nginx作为反向代理的时候启用，开启或者关闭后端服务器返回的结果\n  # 匹配的前提是后端服务器必须要返回包含"Via"的 header头\n  # off(关闭所有代理结果的数据的压缩)\n  # expired(启用压缩,如果header头中包括"Expires"头信息)\n  # no-cache(启用压缩,header头中包含"Cache-Control:no-cache")\n  # no-store(启用压缩,header头中包含"Cache-Control:no-store")\n  # private(启用压缩,header头中包含"Cache-Control:private")\n  # no_last_modefied(启用压缩,header头中不包含"Last-Modified")\n  # no_etag(启用压缩,如果header头中不包含"Etag"头信息)\n  # auth(启用压缩,如果header头中包含"Authorization"头信息)\n  # any - 无条件启用压缩\n  gzip_proxied any;\n  # 请求加个 vary头，给代理服务器用的，有的浏览器支持压缩，有的不支持，所以避免浪费不支持的也压缩\n  gzip_vary on;\n  # 同 compression-webpack-plugin 插件一样，gzip压缩比（1~9），\n  # 越小压缩效果越差，但是越大处理越慢，一般取中间值\n  gzip_comp_level 6;\n  # 获取多少内存用于缓存压缩结果，‘16  8k’表示以8k*16 为单位获得。\n  # PS: 如果没有.gz文件，是需要Nginx实时压缩的\n  gzip_buffers 16 8k;\n  # 注：99.99%的浏览器基本上都支持gzip解压了，所以可以不用设这个值,保持系统默认即可。\n  gzip_http_version 1.1;\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("p",[s._v("配置完 "),t("code",[s._v("nginx")]),s._v(" 然后进行重启，如果此时发现报错信息是 "),t("code",[s._v('unknown directive "gzip_static"')]),s._v(" ，意味着 "),t("code",[s._v("nginx")]),s._v(" 没有安装该模块，解决办法如下：\n进入到 nginx 安装目录，执行以下命令：")]),s._v(" "),t("p",[s._v("进入到 nginx 安装目录，执行以下命令：")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("configure "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http_gzip_static_module\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后执行：")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("make "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" make install\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("关闭 nginx：")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("systemctl stop nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("启动 nginx：")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("systemctl start nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"检查-gzip-是否生效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查-gzip-是否生效"}},[s._v("#")]),s._v(" 检查 gzip 是否生效")]),s._v(" "),t("p",[s._v("浏览器文件请求的请求头包含字段 "),t("code",[s._v("Accept-Encoding: gzip")]),s._v(" 代表浏览器支持 "),t("code",[s._v("gzip")]),s._v(" 压缩文件，文件响应头包含字段 "),t("code",[s._v("Content-Encoding: gzip")]),s._v(" 代表返回的是压缩文件。")]),s._v(" "),t("p",[s._v("上面 "),t("code",[s._v("nginx")]),s._v(" 配置 "),t("code",[s._v("gzip_static on;")]),s._v(" 当我们不在  "),t("code",[s._v("nginx")]),s._v("  开启 "),t("code",[s._v("gzip_static")]),s._v(" 的时候，发现生产的 "),t("code",[s._v("gz")]),s._v(" 文件并没有被运行。"),t("code",[s._v("gzip_static")]),s._v(" 是会自动执行 "),t("code",[s._v("gz")]),s._v(" 文件的，这样的就避免了通过 "),t("code",[s._v("gzip")]),s._v(" 自动压缩。换句话说，开启之后 "),t("code",[s._v("nginx")]),s._v(" 会优先使用我们的 "),t("code",[s._v("gz")]),s._v(" 文件。")]),s._v(" "),t("p",[s._v("如果 "),t("code",[s._v("nginx")]),s._v(" 使用了已有的 "),t("code",[s._v("gz")]),s._v(" 文件，那么这个请求的 "),t("code",[s._v("etag")]),s._v(" 值不带有 "),t("code",[s._v("W/")]),s._v("，反之，如果文件是 "),t("code",[s._v("nginx")]),s._v(" 压缩的，"),t("code",[s._v("etag")]),s._v(" 值则会带有 "),t("code",[s._v("W/")]),s._v("。我们以刚才罗列的 "),t("code",[s._v("app.aea87398.js")]),s._v(" 为例，下面是 "),t("code",[s._v("Response Headers")]),s._v(" ：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('Cache-Control: max-age=2592000\nCache-Control: public\nContent-Encoding: gzip\nContent-Length: 455941\nContent-Type: application/javascript\nDate: Thu, 06 Aug 2020 03:17:24 GMT\nEtag: "5f2b6d5e-6f505"\nExpires: Sat, 05 Sep 2020 03:17:24 GMT\nLast-Modified: Thu, 06 Aug 2020 02:39:26 GMT\nServer: nginx/1.9.9\nVary: Accept-Encoding\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("会发现 "),t("code",[s._v("Etag")]),s._v(" 的值为"),t("code",[s._v('"5f2b6d5e-6f505"')]),s._v(" ，该值不以 "),t("code",[s._v("W/")]),s._v(" 开头，则意味着使用了我们自己打包生成的 "),t("code",[s._v("gz")]),s._v(" 文件。")])])}),[],!1,null,null,null);a.default=e.exports}}]);