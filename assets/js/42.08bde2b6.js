(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{858:function(e,a,v){"use strict";v.r(a);var _=v(77),t=Object(_.a)({},(function(){var e=this,a=e.$createElement,v=e._self._c||a;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("h1",{attrs:{id:"云析培训"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#云析培训"}},[e._v("#")]),e._v(" 云析培训")]),e._v(" "),v("h2",{attrs:{id:"介绍"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[e._v("#")]),e._v(" 介绍")]),e._v(" "),v("p",[e._v("云析是天网的可视化分析模块，技术栈采用了"),v("code",[e._v("WebGL + Canvas + pixiJS + WebAssembly")]),e._v("。本质就是基于实体与链接进行上图，生成可以进行分析操作的有向图。\n云析仓库位于"),v("code",[e._v("tieshangongzhu")]),e._v("，依赖"),v("code",[e._v("shuiliandong")]),e._v("，是整个云析的核心仓库。")]),e._v(" "),v("h3",{attrs:{id:"注意事项"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[e._v("#")]),e._v(" 注意事项")]),e._v(" "),v("p",[e._v("由于云析已拆分为独立的仓库，因此在本地开发的过程中需要本地启动nginx模拟开发环境登录。目的是将云析需要的ELP和权限相关配置存储在本地，否则云析启动会报错。")]),e._v(" "),v("h3",{attrs:{id:"elp"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#elp"}},[e._v("#")]),e._v(" ELP")]),e._v(" "),v("p",[e._v("ELP包括entity、link、property。\n前端存储于"),v("code",[e._v("localStorage")]),e._v("下的"),v("code",[e._v("globalElpModel")]),e._v("。")]),e._v(" "),v("h2",{attrs:{id:"组成"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#组成"}},[e._v("#")]),e._v(" 组成")]),e._v(" "),v("p",[e._v("云析的入口页面位于"),v("code",[e._v("analyticGraph.vue")]),e._v("。与业务相关的逻辑基本都在该页面。\n初始化的总入口是"),v("code",[e._v("initMountedHandle")]),e._v("。该方法做了以下几件事：")]),e._v(" "),v("ol",[v("li",[e._v("初始化了PixiRenderer，以及监听一系列的事件。")]),e._v(" "),v("li",[e._v("调用loadGraphData，该方法会从后端加载图表，如果失败则前端创建临时图表，核心是调用了Chart。")]),e._v(" "),v("li",[e._v("绑定一系列的快捷键。")])]),e._v(" "),v("h3",{attrs:{id:"pixirenderer"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#pixirenderer"}},[e._v("#")]),e._v(" PixiRenderer")]),e._v(" "),v("p",[e._v("基于pixiJS，提供操作实体和链接的API，并做了以下几件事：")]),e._v(" "),v("ol",[v("li",[e._v("监听"),v("code",[e._v("Graph")]),e._v("上的"),v("code",[e._v("changed")]),e._v("事件，并执行"),v("code",[e._v("onGraphChanged")]),e._v("回调函数，该方法内部对实体和链接做了增删改的操作。")]),e._v(" "),v("li",[e._v("实现了"),v("code",[e._v("animationLoop")]),e._v("方法，"),v("code",[e._v("animationLoop")]),e._v("方法是建立在rAF（requestAnimationFrame）上的，实现了浏览器每次刷新的时候会执行内部的代码：")])]),e._v(" "),v("blockquote",[v("ul",[v("li",[v("code",[e._v("animationLoop")]),e._v("内部包含了部分优化处理逻辑，以及真正的渲染操作核心是"),v("code",[e._v("this.renderer.render(this.stage)")]),e._v("，这段代码的本质就是将stage（pixijs中的顶层容器对象）作为渲染参数来渲染到页面；")]),e._v(" "),v("li",[e._v("除了上面的"),v("code",[e._v("render")]),e._v("函数，其余所有文件的操作其实都是在操作对象，把"),v("code",[e._v("stage")]),e._v("容器中的自对象按正确的逻辑进行处理，不涉及到任何渲染；")])])]),e._v(" "),v("h3",{attrs:{id:"chart"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#chart"}},[e._v("#")]),e._v(" Chart")]),e._v(" "),v("p",[e._v("在Chart.js中，根据不同的条件创建不同的Graph（OriginGraph.js, RemoteGraph.js, FinalGraph.js），这三个都是都是"),v("code",[e._v("Graph")]),e._v("的子类，同时继承了"),v("code",[e._v("EventEmitter")]),e._v("类。意味着不同的图层实现了观察者模式，可以监听到指定的事件。")]),e._v(" "),v("p",[v("code",[e._v("Chart初始化")]),e._v("与调用"),v("code",[e._v("execute")]),e._v("时的操作:\n"),v("img",{attrs:{src:"https://img-node.oss-cn-shanghai.aliyuncs.com/images/execute.png",alt:"execute"}})]),e._v(" "),v("p",[e._v("以添加数据的方法"),v("code",[e._v("addSubGraph")]),e._v("为例，上图左侧是Chart代码初始化时调用栈的顺序，右侧是调用"),v("code",[e._v("execute")]),e._v("\n时的顺序。当代码执行"),v("code",[e._v("this.chart.execute('addSubGraph')")]),e._v("时，流程如下：")]),e._v(" "),v("ol",[v("li",[e._v("执行"),v("code",[e._v("Chart")]),e._v("里的"),v("code",[e._v("execute")]),e._v("方法，然后执行"),v("code",[e._v("this.commandManager.execute('addSubGraph')")]),e._v("。")]),e._v(" "),v("li",[e._v("执行"),v("code",[e._v("CommandManager")]),e._v("里的"),v("code",[e._v("execute")]),e._v("方法，经过查找会执行"),v("code",[e._v("this.graphForRender.execute('addSubGraph')")]),e._v("。")]),e._v(" "),v("li",[v("code",[e._v("this.graphForRender")]),e._v(" 实质是"),v("code",[e._v("Chart")]),e._v("里返回的"),v("code",[e._v("this.finalGraph")]),e._v("，按照上图左侧的调用栈顺序执行，最终会执行"),v("code",[e._v("OriginalGraph")]),e._v("里的"),v("code",[e._v("addSubGraph")]),e._v("方法。")]),e._v(" "),v("li",[e._v("触发"),v("code",[e._v("Graph")]),e._v("的"),v("code",[e._v("this.emit('changed')")]),e._v("事件，由于在"),v("code",[e._v("pixiRenderer")]),e._v("监听了"),v("code",[e._v("changed")]),e._v("事件，因此会触发刚才提到的"),v("code",[e._v("onGraphChanged")]),e._v("回调函数，执行对实体链接的增删改操作。")])]),e._v(" "),v("h2",{attrs:{id:"优化"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#优化"}},[e._v("#")]),e._v(" 优化")]),e._v(" "),v("p",[e._v("目前的云析有着较大的性能瓶颈，上图过多就会导致页面崩溃。目前已经在原有的基础上优化了一部分，但是尚未合到经侦版本当中。后续计划调研原生webGL上图能力，看看是否可以达到要求。")])])}),[],!1,null,null,null);a.default=t.exports}}]);