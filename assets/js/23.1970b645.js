(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{837:function(t,s,a){"use strict";a.r(s);var e=a(77),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"使用-sentry-平台处理客户端异常日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-sentry-平台处理客户端异常日志"}},[t._v("#")]),t._v(" 使用 Sentry 平台处理客户端异常日志")]),t._v(" "),a("h2",{attrs:{id:"介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),a("p",[t._v("引用官方的描述，"),a("code",[t._v("Sentry")]),t._v(" 的应用程序监视平台可为每位开发人员提供帮助诊断，修复和优化其代码的性能。")]),t._v(" "),a("h2",{attrs:{id:"注册"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册"}},[t._v("#")]),t._v(" 注册")]),t._v(" "),a("p",[t._v("首先进入"),a("a",{attrs:{href:"https://sentry.io/signup/",target:"_blank",rel:"noopener noreferrer"}},[t._v("注册页面"),a("OutboundLink")],1),t._v("注册一个账号，Email最好填公司的邮箱，方便接收告警信息。")]),t._v(" "),a("p",[t._v("注册成功后，选择"),a("code",[t._v("JavaScript")]),t._v(" 语言，点击"),a("code",[t._v("Create Project")]),t._v(" 。")]),t._v(" "),a("h2",{attrs:{id:"引入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引入"}},[t._v("#")]),t._v(" 引入")]),t._v(" "),a("p",[t._v("集成地址："),a("a",{attrs:{href:"https://docs.sentry.io/platforms/javascript/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Sentry"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("要将"),a("code",[t._v("Sentry")]),t._v(" 与"),a("code",[t._v("Vue")]),t._v(" 应用程序一起使用，需要使用Sentry的浏览器"),a("code",[t._v("JavaScript SDK")]),t._v(" :"),a("code",[t._v("@sentry/browser")]),t._v(" 。该"),a("code",[t._v("SDK")]),t._v(" 将报告应用程序触发的任何未捕获的异常。")]),t._v(" "),a("p",[t._v("我们首先在项目中进行安装：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("npm install @sentry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("browser\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("此外，"),a("code",[t._v("Vue")]),t._v(" 集成将捕获引发错误的活动组件的名称和道具状态。这是通过Vue的"),a("code",[t._v("config.errorHandler")]),t._v(" 钩子报告的。")]),t._v(" "),a("p",[t._v("Sentry 5.X版本的Vue集成位于"),a("code",[t._v("@sentry/integrations")]),t._v(" ，下面来安装：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("npm install @sentry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("integrations\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("然后在项目的入口文件内引入：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Vue "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" Sentry "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@sentry/browser"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Vue "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" VueIntegration "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@sentry/integrations"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\nSentry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  dsn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://c9bee4513d4f44beb9a9603f8bfd7ba3@o437037.ingest.sentry.io/5399023"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  integrations"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("VueIntegration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" attachProps"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" logErrors"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("注意："),a("code",[t._v("init")]),t._v(" 方法里的"),a("code",[t._v("dsn")]),t._v(" 是根据注册信息来生成的，无法公用。")]),t._v(" "),a("p",[t._v("在传递参数方面，"),a("code",[t._v("attachProps")]),t._v(" 是可选的，默认为"),a("code",[t._v("true")]),t._v(" 。如果设置为"),a("code",[t._v("false")]),t._v(" ，"),a("code",[t._v("Sentry")]),t._v(" 将禁止发送所有 "),a("code",[t._v("Vue")]),t._v(" 组件的"),a("code",[t._v("props")]),t._v(" 进行记录。"),a("code",[t._v("logErrors")]),t._v(" 也是可选的，默认为"),a("code",[t._v("false")]),t._v(" 。如果设置为"),a("code",[t._v("true")]),t._v(" ，"),a("code",[t._v("Sentry")]),t._v(" 将调用"),a("code",[t._v("Vue")]),t._v(" 的"),a("code",[t._v("logError")]),t._v(" 函数。如果不声明，这就意味着在Vue渲染器中发生的错误不会打印在控制台上，所以这里我们显式声明该参数。")]),t._v(" "),a("p",[t._v("到此，已经为项目成功引入了"),a("code",[t._v("Sentry")]),t._v(" 。")]),t._v(" "),a("h2",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),a("p",[t._v("当引入完成后，启动项目，再回到刚才注册成功的页面，会有一个"),a("code",[t._v("Take me to my event")]),t._v(" 的入口，点击进入就可以看到日常日志输出到控制台。")]),t._v(" "),a("p",[t._v("这里我创建了一个叫做"),a("code",[t._v("zqykj")]),t._v(" 的监控项目，这里是"),a("a",{attrs:{href:"https://sentry.io/organizations/zqykj/projects/",target:"_blank",rel:"noopener noreferrer"}},[t._v("监控地址"),a("OutboundLink")],1),t._v("。主页如下所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img-node.oss-cn-shanghai.aliyuncs.com/images/sentry.png",alt:"sentry"}})]),t._v(" "),a("p",[t._v("如果需要在有新的错误信息的时候，想要及时获悉，需要配置一下告警规则。点击左侧的"),a("code",[t._v("Alerts")]),t._v(" ，然后点击页面右上方的"),a("code",[t._v("Create Alert Rule")]),t._v(" ，添加最基本的警告规则，这里选择第一条规则"),a("code",[t._v("An event is seen")]),t._v(" 。然后选择发送邮件的对象，默认是发送给自己，也可以选择团队。速率限制选择5分钟，然后填入一个规则名称，最后保存。规则如图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://img-node.oss-cn-shanghai.aliyuncs.com/images/sentryRule.png",alt:"sentryRule"}})]),t._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[a("code",[t._v("Sentry")]),t._v(" 的引入可以很方便的监听到一些错误信息，可以清晰的看到错误信息的来源，包括浏览器信息、操作系统、出错的URL地址，以及栈信息。相信此工具可以极大的提高我们开发人员定位bug的效率。")]),t._v(" "),a("p",[t._v("最后，我们也可以选择将此工具配置到公司内网，Github地址为："),a("a",{attrs:{href:"https://github.com/getsentry/onpremise",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/getsentry/onpremise"),a("OutboundLink")],1),t._v(" ，这部分超出了前端的范畴，在此不做记录。")])])}),[],!1,null,null,null);s.default=r.exports}}]);