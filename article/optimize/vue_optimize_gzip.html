<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Vue 项目优化实践-Gzip 篇 | 智器云</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/f2e_standred/favicon.ico">
    <meta name="description" content="智器云大数据前端开发规范">
    <link rel="preload" href="/f2e_standred/assets/css/0.styles.4e71d8fc.css" as="style"><link rel="preload" href="/f2e_standred/assets/js/app.72858c04.js" as="script"><link rel="preload" href="/f2e_standred/assets/js/2.3b4d6e1e.js" as="script"><link rel="preload" href="/f2e_standred/assets/js/33.2277f45e.js" as="script"><link rel="prefetch" href="/f2e_standred/assets/js/10.3167e56c.js"><link rel="prefetch" href="/f2e_standred/assets/js/11.9074b1ae.js"><link rel="prefetch" href="/f2e_standred/assets/js/12.9da03d16.js"><link rel="prefetch" href="/f2e_standred/assets/js/13.f64e72c9.js"><link rel="prefetch" href="/f2e_standred/assets/js/14.66701d9d.js"><link rel="prefetch" href="/f2e_standred/assets/js/15.655a214d.js"><link rel="prefetch" href="/f2e_standred/assets/js/16.b5c59ffa.js"><link rel="prefetch" href="/f2e_standred/assets/js/17.3dafb5f7.js"><link rel="prefetch" href="/f2e_standred/assets/js/18.c50ef054.js"><link rel="prefetch" href="/f2e_standred/assets/js/19.036665c6.js"><link rel="prefetch" href="/f2e_standred/assets/js/20.c3ec8502.js"><link rel="prefetch" href="/f2e_standred/assets/js/21.468483ae.js"><link rel="prefetch" href="/f2e_standred/assets/js/22.365cfd83.js"><link rel="prefetch" href="/f2e_standred/assets/js/23.1970b645.js"><link rel="prefetch" href="/f2e_standred/assets/js/24.f36958fa.js"><link rel="prefetch" href="/f2e_standred/assets/js/25.9588f950.js"><link rel="prefetch" href="/f2e_standred/assets/js/26.a7f4538e.js"><link rel="prefetch" href="/f2e_standred/assets/js/27.a0380fae.js"><link rel="prefetch" href="/f2e_standred/assets/js/28.72d270ed.js"><link rel="prefetch" href="/f2e_standred/assets/js/29.187aa293.js"><link rel="prefetch" href="/f2e_standred/assets/js/3.1eed06c3.js"><link rel="prefetch" href="/f2e_standred/assets/js/30.d21a70f2.js"><link rel="prefetch" href="/f2e_standred/assets/js/31.541ded4a.js"><link rel="prefetch" href="/f2e_standred/assets/js/32.edc8f3fc.js"><link rel="prefetch" href="/f2e_standred/assets/js/34.cac2117d.js"><link rel="prefetch" href="/f2e_standred/assets/js/35.08b63ac6.js"><link rel="prefetch" href="/f2e_standred/assets/js/36.c438672e.js"><link rel="prefetch" href="/f2e_standred/assets/js/37.b878d026.js"><link rel="prefetch" href="/f2e_standred/assets/js/38.11ee6710.js"><link rel="prefetch" href="/f2e_standred/assets/js/39.97961b98.js"><link rel="prefetch" href="/f2e_standred/assets/js/4.4a148623.js"><link rel="prefetch" href="/f2e_standred/assets/js/40.9af12117.js"><link rel="prefetch" href="/f2e_standred/assets/js/41.6ac12529.js"><link rel="prefetch" href="/f2e_standred/assets/js/42.08bde2b6.js"><link rel="prefetch" href="/f2e_standred/assets/js/43.1d15a355.js"><link rel="prefetch" href="/f2e_standred/assets/js/44.001f7e07.js"><link rel="prefetch" href="/f2e_standred/assets/js/45.a471c763.js"><link rel="prefetch" href="/f2e_standred/assets/js/46.083b23cc.js"><link rel="prefetch" href="/f2e_standred/assets/js/47.7a21879e.js"><link rel="prefetch" href="/f2e_standred/assets/js/48.4ff82afa.js"><link rel="prefetch" href="/f2e_standred/assets/js/49.3c85f569.js"><link rel="prefetch" href="/f2e_standred/assets/js/5.70c67b70.js"><link rel="prefetch" href="/f2e_standred/assets/js/50.50a6170b.js"><link rel="prefetch" href="/f2e_standred/assets/js/51.c609a729.js"><link rel="prefetch" href="/f2e_standred/assets/js/6.36ef3494.js"><link rel="prefetch" href="/f2e_standred/assets/js/7.4b893627.js"><link rel="prefetch" href="/f2e_standred/assets/js/8.d9341198.js"><link rel="prefetch" href="/f2e_standred/assets/js/9.d63f1cf0.js">
    <link rel="stylesheet" href="/f2e_standred/assets/css/0.styles.4e71d8fc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/f2e_standred/" class="router-link-active home-link"><img src="/f2e_standred/img/logo.png" alt="智器云" class="logo"> <span class="site-name">智器云</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/f2e_standred/" class="router-link-active">
          首页
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/f2e_standred/guide/JavaScript.html">
          规范
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item ant-menu-item-selected"><a href="/f2e_standred/article/optimize/vue_optimize_gzip.html" class="router-link-exact-active router-link-active">
          文章
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <!----></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>项目优化实践</span> <span class="arrow down"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/f2e_standred/article/optimize/vue_optimize_gzip.html" title="Vue 项目优化实践-Gzip 篇" class="active sidebar-link">Vue 项目优化实践-Gzip 篇</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/f2e_standred/article/optimize/vue_optimize_gzip.html#前端页面文件缓存" title="前端页面文件缓存" class="sidebar-link">前端页面文件缓存</a></li><li class="sidebar-sub-header"><a href="/f2e_standred/article/optimize/vue_optimize_gzip.html#服务器配置缓存" title="服务器配置缓存" class="sidebar-link">服务器配置缓存</a></li><li class="sidebar-sub-header"><a href="/f2e_standred/article/optimize/vue_optimize_gzip.html#前端文件设置-gzip-压缩" title="前端文件设置 gzip 压缩" class="sidebar-link">前端文件设置 gzip 压缩</a></li><li class="sidebar-sub-header"><a href="/f2e_standred/article/optimize/vue_optimize_gzip.html#服务器配置-gzip-压缩" title="服务器配置 gzip 压缩" class="sidebar-link">服务器配置 gzip 压缩</a></li><li class="sidebar-sub-header"><a href="/f2e_standred/article/optimize/vue_optimize_gzip.html#检查-gzip-是否生效" title="检查 gzip 是否生效" class="sidebar-link">检查 gzip 是否生效</a></li></ul></li><li><a href="/f2e_standred/article/optimize/vue_optimize_webpack.html" title="Vue 项目优化实践-webpack 篇" class="sidebar-link">Vue 项目优化实践-webpack 篇</a></li><li><a href="/f2e_standred/article/optimize/vue_optimize_branch.html" title="Vue 项目优化实践-优化逻辑判断" class="sidebar-link">Vue 项目优化实践-优化逻辑判断</a></li><li><a href="/f2e_standred/article/optimize/vue_optimize_standard.html" title="Vue 项目优化实践-规范篇" class="sidebar-link">Vue 项目优化实践-规范篇</a></li><li><a href="/f2e_standred/article/optimize/vue_optimize_commit.html" title="优雅的提交 Git Commit Message" class="sidebar-link">优雅的提交 Git Commit Message</a></li><li><a href="/f2e_standred/article/optimize/tailwindcss.html" title="Vue项目引入tailwind.css" class="sidebar-link">Vue项目引入tailwind.css</a></li><li><a href="/f2e_standred/article/optimize/Performance.html" title="性能优化指标" class="sidebar-link">性能优化指标</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术探索</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术总结</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue相关</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>代码片段</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>资源收集</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>杂记</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="vue-项目优化实践-gzip-篇"><a href="#vue-项目优化实践-gzip-篇" class="header-anchor">#</a> Vue 项目优化实践-Gzip 篇</h1> <h2 id="前端页面文件缓存"><a href="#前端页面文件缓存" class="header-anchor">#</a> 前端页面文件缓存</h2> <p>我们先来简单回顾下 http 缓存的知识：</p> <ul><li><code>HTTP1.0</code> 是通过<code>Expires</code>（文件过期时间）和<code>Last-Modified</code>（最近修改时间）来告诉浏览器进行缓存的，这两个字段都是  UTC  时间（绝对时间）。<code>Expires</code> 过期控制不稳定，因为浏览器端可以随意修改本地时间，导致缓存使用不精准。而且 <code>Last-Modified</code> 过期时间只能精确到秒。</li> <li><code>HTTP1.1</code>  通过<code>Cache-Contorl</code>和  <code>Etag</code>（版本号）进行缓存控制。浏览器先检查  <code>Cache-Control</code>，如果有，则以<code>Cache-Control</code> 为准，忽略<code>Expires</code>。如果没有  <code>Cache-Control</code>，则以<code>Expires</code> 为准。</li></ul> <p><code>Cache-Control</code> 除了可以设置 <code>max-age</code>（相对过期时间，以秒为单位）以外，还可以设置如下几种常用值:</p> <ul><li><code>public</code>，资源允许被中间服务器缓存。浏览器请求服务器时，如果缓存时间没到，中间服务器直接返回给浏览器内容，而不必请求源服务器。</li> <li><code>private</code>，资源不允许被中间代理服务器缓存。浏览器请求服务器时，中间服务器都要把浏览器的请求透传给服务器。</li> <li><code>no-cache</code>，不管本地副本是否过期，每次访问资源，浏览器都要向服务器询问，如果文件没变化，服务器只告诉浏览器继续使用缓存（304）。</li> <li><code>no-store</code>，浏览器和中间代理服务器都不能缓存资源。每次访问资源，浏览器都必须请求服务器，并且，服务器不去检查文件是否变化，而是直接返回完整的资源。</li> <li><code>must-revalidate</code>，本地副本过期前，可以使用本地副本；本地副本一旦过期，必须去源服务器进行有效性校验。</li> <li><code>proxy-revalidate</code>，要求代理服务器针对缓存资源向源服务器进行确认。</li> <li><code>s-maxage</code>：缓存服务器对资源缓存的最大时间。</li></ul> <p>现在 99%的浏览器都是 HTTP1.1 及以上版本，我们配置缓存就使用 <code>Cache-Contorl</code> 和 <code>Etag</code> 配合就好了。</p> <h2 id="服务器配置缓存"><a href="#服务器配置缓存" class="header-anchor">#</a> 服务器配置缓存</h2> <p>文件名带 hash 的(即 css、js、font 和 img 目录下的所有文件)设置一个月缓存，浏览器可以直接使用缓存不需要请求服务器。其他的文件（index.html 和 static 目录下的文件）设置为 <code>no-cache</code>，即每次都来服务器检查是否最新。nginx 配置如下：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>server <span class="token punctuation">{</span>
    location = /index.html <span class="token punctuation">{</span>
        add_header Cache-Control no-cache;
    <span class="token punctuation">}</span>

    location ~ /static/ <span class="token punctuation">{</span>
        add_header Cache-Control no-cache;
    <span class="token punctuation">}</span>

    location ~ /(js/_|css/_|img/_|font/_) <span class="token punctuation">{</span>
        expires <span class="token number">30</span>d;
        add_header Cache-Control public;
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="前端文件设置-gzip-压缩"><a href="#前端文件设置-gzip-压缩" class="header-anchor">#</a> 前端文件设置 gzip 压缩</h2> <p>首先需要安装一个 <code>webpack</code> 插件，作用是将大文件压缩成 <code>gzip</code> 的格式。执行一下命令进行安装：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev compression<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装成功后，在 <code>vue.config.js</code> 进行配置，配置如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> CompressionWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;compression-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 可加入需要的其他文件类型，比如json</span>
<span class="token comment">// 图片不要压缩，体积会比原来还大</span>
<span class="token keyword">const</span> productionGzipExtensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">configureWebpack</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token keyword">new</span> <span class="token class-name">CompressionWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// filename: '[path].gz[query]',</span>
            algorithm<span class="token operator">:</span> <span class="token string">&quot;gzip&quot;</span><span class="token punctuation">,</span>
            test<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>
              <span class="token string">&quot;\\.(&quot;</span> <span class="token operator">+</span> productionGzipExtensions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;|&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)$&quot;</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            threshold<span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">,</span> <span class="token comment">//对超过10k的数据进行压缩</span>
            minRatio<span class="token operator">:</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token comment">// 压缩比例，值为0 ~ 1</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>这样配置后，打包完的 js 和 css 文件就多了后缀名为 <code>gz</code> 的文件，下面是是否开启 <code>gzip</code> 压缩的文件大小对比：</p> <table><thead><tr><th>File</th> <th>Size</th> <th>Gzipped</th></tr></thead> <tbody><tr><td>dist\static\lib\echarts.4.0.6.min.js</td> <td>729.99KB</td> <td>243.57KB</td></tr> <tr><td>dis\static\lib\jquery.3.3.1.min.js</td> <td>84.89KB</td> <td>29.65KB</td></tr> <tr><td>dist\js\chuck-vendors.41428558.js</td> <td>2316.10KB</td> <td>623.74KB</td></tr> <tr><td>dist\js\app.aea87398.js</td> <td>1701.24KB</td> <td>447.00KB</td></tr> <tr><td>dist\css\app.c6e9f88a.css</td> <td>464.43KB</td> <td>137.84KB</td></tr> <tr><td>dist\css\chunk-vendors.aa340280.css</td> <td>263.42KB</td> <td>38.56KB</td></tr></tbody></table> <h2 id="服务器配置-gzip-压缩"><a href="#服务器配置-gzip-压缩" class="header-anchor">#</a> 服务器配置 gzip 压缩</h2> <p>Nginx 服务器的配置文件 <code>nginx.conf</code> 的 <code>http</code> 模块：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>server {
  # 开启gzip on为开启，off为关闭
  gzip on;
  # 检查是否存在请求静态文件的gz结尾的文件，如果有则直接返回该gz文件内容，不存在则先压缩再返回
  gzip_static on;
  # 设置允许压缩的页面最小字节数，页面字节数从header头中的Content-Length中进行获取。
  # 默认值是0，不管页面多大都压缩。
  # 建议设置成大于10k的字节数，配合compression-webpack-plugin
  gzip_min_length 10k;
  # 对特定的MIME类型生效,其中'text/html’被系统强制启用
  gzip_types text/javascript application/javascript text/css application/json;
  # Nginx作为反向代理的时候启用，开启或者关闭后端服务器返回的结果
  # 匹配的前提是后端服务器必须要返回包含&quot;Via&quot;的 header头
  # off(关闭所有代理结果的数据的压缩)
  # expired(启用压缩,如果header头中包括&quot;Expires&quot;头信息)
  # no-cache(启用压缩,header头中包含&quot;Cache-Control:no-cache&quot;)
  # no-store(启用压缩,header头中包含&quot;Cache-Control:no-store&quot;)
  # private(启用压缩,header头中包含&quot;Cache-Control:private&quot;)
  # no_last_modefied(启用压缩,header头中不包含&quot;Last-Modified&quot;)
  # no_etag(启用压缩,如果header头中不包含&quot;Etag&quot;头信息)
  # auth(启用压缩,如果header头中包含&quot;Authorization&quot;头信息)
  # any - 无条件启用压缩
  gzip_proxied any;
  # 请求加个 vary头，给代理服务器用的，有的浏览器支持压缩，有的不支持，所以避免浪费不支持的也压缩
  gzip_vary on;
  # 同 compression-webpack-plugin 插件一样，gzip压缩比（1~9），
  # 越小压缩效果越差，但是越大处理越慢，一般取中间值
  gzip_comp_level 6;
  # 获取多少内存用于缓存压缩结果，‘16  8k’表示以8k*16 为单位获得。
  # PS: 如果没有.gz文件，是需要Nginx实时压缩的
  gzip_buffers 16 8k;
  # 注：99.99%的浏览器基本上都支持gzip解压了，所以可以不用设这个值,保持系统默认即可。
  gzip_http_version 1.1;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>配置完 <code>nginx</code> 然后进行重启，如果此时发现报错信息是 <code>unknown directive &quot;gzip_static&quot;</code> ，意味着 <code>nginx</code> 没有安装该模块，解决办法如下：
进入到 nginx 安装目录，执行以下命令：</p> <p>进入到 nginx 安装目录，执行以下命令：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">.</span><span class="token operator">/</span>configure <span class="token operator">--</span><span class="token keyword">with</span><span class="token operator">-</span>http_gzip_static_module
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后执行：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>make <span class="token operator">&amp;&amp;</span> make install
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>关闭 nginx：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>systemctl stop nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>启动 nginx：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>systemctl start nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="检查-gzip-是否生效"><a href="#检查-gzip-是否生效" class="header-anchor">#</a> 检查 gzip 是否生效</h2> <p>浏览器文件请求的请求头包含字段 <code>Accept-Encoding: gzip</code> 代表浏览器支持 <code>gzip</code> 压缩文件，文件响应头包含字段 <code>Content-Encoding: gzip</code> 代表返回的是压缩文件。</p> <p>上面 <code>nginx</code> 配置 <code>gzip_static on;</code> 当我们不在  <code>nginx</code>  开启 <code>gzip_static</code> 的时候，发现生产的 <code>gz</code> 文件并没有被运行。<code>gzip_static</code> 是会自动执行 <code>gz</code> 文件的，这样的就避免了通过 <code>gzip</code> 自动压缩。换句话说，开启之后 <code>nginx</code> 会优先使用我们的 <code>gz</code> 文件。</p> <p>如果 <code>nginx</code> 使用了已有的 <code>gz</code> 文件，那么这个请求的 <code>etag</code> 值不带有 <code>W/</code>，反之，如果文件是 <code>nginx</code> 压缩的，<code>etag</code> 值则会带有 <code>W/</code>。我们以刚才罗列的 <code>app.aea87398.js</code> 为例，下面是 <code>Response Headers</code> ：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Cache-Control: max-age=2592000
Cache-Control: public
Content-Encoding: gzip
Content-Length: 455941
Content-Type: application/javascript
Date: Thu, 06 Aug 2020 03:17:24 GMT
Etag: &quot;5f2b6d5e-6f505&quot;
Expires: Sat, 05 Sep 2020 03:17:24 GMT
Last-Modified: Thu, 06 Aug 2020 02:39:26 GMT
Server: nginx/1.9.9
Vary: Accept-Encoding
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>会发现 <code>Etag</code> 的值为<code>&quot;5f2b6d5e-6f505&quot;</code> ，该值不以 <code>W/</code> 开头，则意味着使用了我们自己打包生成的 <code>gz</code> 文件。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/f2e_standred/article/optimize/vue_optimize_webpack.html">
        Vue 项目优化实践-webpack 篇
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/f2e_standred/assets/js/app.72858c04.js" defer></script><script src="/f2e_standred/assets/js/2.3b4d6e1e.js" defer></script><script src="/f2e_standred/assets/js/33.2277f45e.js" defer></script>
  </body>
</html>